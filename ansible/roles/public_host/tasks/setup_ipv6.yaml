---
- name: 'Setup IPv6-related stuff in sysctl'  # TODO
  ansible.builtin.template:
    dest: '/etc/sysctl.d/05-ipv6.conf'
    mode: '0644'
    src:  'etc/sysctl.d/05-ipv6.conf'
  notify:
    - 'Reload system'

- name: 'Setup IPv6'  # TODO
  ansible.builtin.lineinfile:
    line:  '{{ item.name }}={{ item.value }}'
    path:  '/etc/NetworkManager/system-connections/{{ default_ipv4["interface"] }}.nmconnection'
    regex: '^{{ item.name }}'
  notify:
    - 'Reload system'
  loop:
    - name:  'IPV6INIT'
      value: 'yes'
    - name:  'IPV6_AUTOCONF'
      value: 'no'
    - name:  'IPV6_DEFROUTE'
      value: 'yes'
    - name:  'IPV6_FAILURE_FATAL'
      value: 'no'
    - name:  'IPV6ADDR'
      value: '{{ ipv6_addr }}'
    - name:  'IPV6_DEFAULTGW'
      value: '{{ ipv6_defaultgw }}'
