{% extends '_base.html.twig' %}

{% block title %}Submission {{ update.submission.id }}{% endblock %}

{% block body %}
    <h1>{{ block('title') }}</h1>

    {% if update.matchedArtisans|length > 1 %} {# TODO: Improve this section #}
        <p>Matched multiple makers - fail</p>
    {% elseif update.matchedArtisans is empty %}
        <p>Creating a new maker</p>
    {% else %}
        {% set maker = update.matchedArtisans|first %}
        <p>Updating: {{ maker.makerId }}</p>
    {% endif %}

    <table class="table table-sm" id="mx-submission">
        <thead>
            <tr>
                <th>Field</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
            {% for field in fields %}
                {% set submitted_different = update.submittedDifferent(field) %}
                {% set fixes_applied = update.fixesApplied(field) %}
                {% set is_changing = update.isChanging(field) %}

                {% set row_class = (submitted_different ? 'submitted-different' : 'submitted-same')
                    ~ ' ' ~ (fixes_applied ? 'fixes-applied' : 'not-fixed')
                    ~ ' ' ~ (is_changing ? 'changing' : 'not-changing')
                %}

                <tr class="{{ field.value }} current {{ row_class }}">
                    <td>{{ field.name }}&nbsp;[current]</td>
                    <td>{{ update.originalArtisan.get(field)|as_str }}</td>
                </tr>

                <tr class="{{ field.value }} submitted {{ row_class }}">
                    <td>{{ field.name }}&nbsp;[submitted]</td>
                    <td>{{ update.originalInput.get(field)|as_str }}</td>
                </tr>

                <tr class="{{ field.value }} changed {{ row_class }}">
                    <td>{{ field.name }}&nbsp;[changed]</td>
                    <td>{{ update.updatedArtisan.get(field)|as_str }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
